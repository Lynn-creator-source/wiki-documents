# PIR

## 技术概述

**PIR（被动红外）传感器**通过检测人体或动物发出的红外辐射变化来实现运动检测，具有以下特点：
- 检测范围：3-7米
- 检测角度：水平110°，垂直90°
- 工作电压：3.3V-5V
- 低功耗设计，适合电池供电场景

### 典型应用场景
- 安防监控系统
- 智能照明控制
- 自动抓拍系统
- 智能家居自动化

## 开发准备

### 硬件配置
- 标准开发主板（ESP32-S3核心板）
- PIR传感器模组（推荐型号：HC-SR501）
- 完整硬件连接指南：[硬件连接说明](.././Hardware%20Guide/Hardware%20Connection)

### 软件资源
1. **预编译固件**：
   - 获取PIR示例固件
   - 烧录方法参考：[开发环境配置指南](./../Software%20Guide/Development%20Environment%20Setup)

2. **源码开发**：
   - 支持本地编译（详见开发实现指南章节）

## 功能验证流程

1. **固件升级**
   - 使用烧录工具写入PIR示例固件

2. **功能测试**
   - 正确连接PIR传感器
   - 上电启动设备，等待初始化完成
   - 进入休眠模式后触发PIR传感器：
     - 观察状态指示灯亮起（唤醒成功标志）
     - 验证自动抓拍和图片上传功能

3. **参数调整**
   - 根据实际需求调整检测灵敏度
   - 完整操作指南参考：[快速入门手册](./../Quick%20Start)

## 开发实现指南

### 开发环境要求
- Visual Studio Code最新版
- ESP-IDF v5.1.1工具链
- PIR示例代码库

### 开发步骤

1. **获取源码**
   ```bash
   mkdir pir && cd pir
   git clone git@github.milesight.com:ne101.git
   ```

2. **启用PIR功能**
   - 修改`main/pir.h`文件：
   ```c
   #define PIR_ENABLE 1  // 启用PIR功能
   ```

3. **GPIO配置**
   - 确保使用RTC GPIO（支持唤醒功能）
   - 避免外部上拉电阻影响信号检测
   
   ![GPIO配置示意图](/img/NE101_example_6.png)

4. **灵敏度调整**
   - 根据应用场景修改检测参数：
   
   ![灵敏度参数配置](/img/NE101_example_5.png)

5. **日志优化**
   - 在menuconfig中将日志等级设置为Error
   - 减少串口输出对时序的影响

6. **编译烧录**
   - 执行完整编译流程
   - 烧录生成固件到设备

## 注意事项

1. **功耗管理**
   - 频繁触发会显著增加功耗
   - 电池供电场景建议：
     - 设置合理的触发间隔
     - 启用深度睡眠模式

2. **系统稳定性**
   - IDF v5.1.1存在深度睡眠唤醒BUG
   - 建议升级至v5.1.6版本

3. **抗干扰设计**
   - 远离电磁干扰源
   - 适当增加PULSE_C参数值

4. **环境适应性**
   - 避免直接阳光照射传感器
   - 保持传感器透镜清洁
   - 根据安装高度调整检测角度
